import 'package:flutter/material.dart';\nimport 'package:get/get.dart';\nimport '../controllers/garden_controller.dart';\nimport '../../../core/data/models/user_plant.dart';\n\nclass GardenView extends GetView<GardenController> {\n  const GardenView({super.key});\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('My Garden'),\n        actions: [\n          IconButton(\n            icon: const Icon(Icons.search),\n            onPressed: () => _showSearchDialog(),\n          ),\n        ],\n      ),\n      body: Obx(() {\n        if (controller.isLoading) {\n          return const Center(child: CircularProgressIndicator());\n        }\n\n        if (controller.error != null) {\n          return Center(\n            child: Column(\n              mainAxisAlignment: MainAxisAlignment.center,\n              children: [\n                Icon(\n                  Icons.error_outline,\n                  size: 64,\n                  color: Theme.of(context).colorScheme.error,\n                ),\n                const SizedBox(height: 16),\n                Text(\n                  'Error loading plants',\n                  style: Theme.of(context).textTheme.titleMedium,\n                ),\n                const SizedBox(height: 8),\n                Text(\n                  controller.error!,\n                  style: Theme.of(context).textTheme.bodyMedium?.copyWith(\n                    color: Theme.of(context).colorScheme.onSurface.withOpacity(0.7),\n                  ),\n                  textAlign: TextAlign.center,\n                ),\n                const SizedBox(height: 16),\n                ElevatedButton(\n                  onPressed: controller.loadUserPlants,\n                  child: const Text('Retry'),\n                ),\n              ],\n            ),\n          );\n        }\n\n        if (controller.userPlants.isEmpty) {\n          return const _EmptyGardenView();\n        }\n\n        return Column(\n          children: [\n            // Stats Card\n            Container(\n              margin: const EdgeInsets.all(16),\n              child: Card(\n                child: Padding(\n                  padding: const EdgeInsets.all(16),\n                  child: Row(\n                    mainAxisAlignment: MainAxisAlignment.spaceAround,\n                    children: [\n                      _StatItem(\n                        icon: Icons.local_florist,\n                        label: 'Total Plants',\n                        value: '${controller.plantCount}',\n                      ),\n                      _StatItem(\n                        icon: Icons.category,\n                        label: 'Categories',\n                        value: '${controller.getUniqueCategories().length}',\n                      ),\n                      _StatItem(\n                        icon: Icons.calendar_today,\n                        label: 'This Month',\n                        value: '${controller.getPlantsAddedThisMonth()}',\n                      ),\n                    ],\n                  ),\n                ),\n              ),\n            ),\n\n            // Plants Grid\n            Expanded(\n              child: GridView.builder(\n                padding: const EdgeInsets.symmetric(horizontal: 16),\n                gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount(\n                  crossAxisCount: 2,\n                  childAspectRatio: 0.8,\n                  crossAxisSpacing: 12,\n                  mainAxisSpacing: 12,\n                ),\n                itemCount: controller.userPlants.length,\n                itemBuilder: (context, index) => _PlantCard(\n                  plant: controller.userPlants[index],\n                  onTap: () => _showPlantDetails(controller.userPlants[index]),\n                  onDelete: () => _deletePlant(controller.userPlants[index]),\n                ),\n              ),\n            ),\n          ],\n        );\n      }),\n      floatingActionButton: FloatingActionButton(\n        onPressed: () => Get.find<HomeController>().changeTabIndex(1),\n        child: const Icon(Icons.add),\n      ),\n    );\n  }\n\n  void _showSearchDialog() {\n    Get.dialog(\n      AlertDialog(\n        title: const Text('Search Plants'),\n        content: TextField(\n          autofocus: true,\n          decoration: const InputDecoration(\n            hintText: 'Enter plant name...',\n            prefixIcon: Icon(Icons.search),\n          ),\n          onChanged: (value) {\n            // Implement search functionality\n          },\n        ),\n        actions: [\n          TextButton(\n            onPressed: () => Get.back(),\n            child: const Text('Close'),\n          ),\n        ],\n      ),\n    );\n  }\n\n  void _showPlantDetails(UserPlant plant) {\n    Get.bottomSheet(\n      Container(\n        padding: const EdgeInsets.all(16),\n        decoration: BoxDecoration(\n          color: Get.theme.scaffoldBackgroundColor,\n          borderRadius: const BorderRadius.vertical(top: Radius.circular(20)),\n        ),\n        child: SingleChildScrollView(\n          child: _PlantDetailsSheet(plant: plant),\n        ),\n      ),\n      isScrollControlled: true,\n    );\n  }\n\n  void _deletePlant(UserPlant plant) {\n    Get.dialog(\n      AlertDialog(\n        title: const Text('Remove Plant'),\n        content: Text(\n          'Are you sure you want to remove ${plant.customName ?? plant.plant.commonName} from your garden?',\n        ),\n        actions: [\n          TextButton(\n            onPressed: () => Get.back(),\n            child: const Text('Cancel'),\n          ),\n          TextButton(\n            onPressed: () {\n              controller.removePlant(plant.id);\n              Get.back();\n            },\n            child: const Text('Remove'),\n          ),\n        ],\n      ),\n    );\n  }\n}\n\nclass _StatItem extends StatelessWidget {\n  final IconData icon;\n  final String label;\n  final String value;\n\n  const _StatItem({\n    required this.icon,\n    required this.label,\n    required this.value,\n  });\n\n  @override\n  Widget build(BuildContext context) {\n    return Column(\n      children: [\n        Icon(icon, color: Theme.of(context).colorScheme.primary),\n        const SizedBox(height: 4),\n        Text(\n          value,\n          style: Theme.of(context).textTheme.titleLarge?.copyWith(\n            fontWeight: FontWeight.bold,\n          ),\n        ),\n        Text(\n          label,\n          style: Theme.of(context).textTheme.bodySmall?.copyWith(\n            color: Theme.of(context).colorScheme.onSurface.withOpacity(0.7),\n          ),\n        ),\n      ],\n    );\n  }\n}\n\nclass _PlantCard extends StatelessWidget {\n  final UserPlant plant;\n  final VoidCallback onTap;\n  final VoidCallback onDelete;\n\n  const _PlantCard({\n    required this.plant,\n    required this.onTap,\n    required this.onDelete,\n  });\n\n  @override\n  Widget build(BuildContext context) {\n    return Card(\n      clipBehavior: Clip.antiAlias,\n      child: InkWell(\n        onTap: onTap,\n        child: Column(\n          crossAxisAlignment: CrossAxisAlignment.start,\n          children: [\n            // Plant Image\n            Expanded(\n              flex: 3,\n              child: Container(\n                width: double.infinity,\n                decoration: BoxDecoration(\n                  color: Theme.of(context).colorScheme.surfaceVariant,\n                ),\n                child: plant.photos.isNotEmpty\n                    ? Image.asset(\n                        plant.photos.first,\n                        fit: BoxFit.cover,\n                        errorBuilder: (context, error, stackTrace) => const _PlaceholderImage(),\n                      )\n                    : const _PlaceholderImage(),\n              ),\n            ),\n            \n            // Plant Info\n            Expanded(\n              flex: 2,\n              child: Padding(\n                padding: const EdgeInsets.all(8),\n                child: Column(\n                  crossAxisAlignment: CrossAxisAlignment.start,\n                  children: [\n                    Text(\n                      plant.customName ?? plant.plant.commonName,\n                      style: Theme.of(context).textTheme.titleSmall?.copyWith(\n                        fontWeight: FontWeight.bold,\n                      ),\n                      maxLines: 1,\n                      overflow: TextOverflow.ellipsis,\n                    ),\n                    Text(\n                      plant.plant.scientificName,\n                      style: Theme.of(context).textTheme.bodySmall?.copyWith(\n                        fontStyle: FontStyle.italic,\n                        color: Theme.of(context).colorScheme.onSurface.withOpacity(0.7),\n                      ),\n                      maxLines: 1,\n                      overflow: TextOverflow.ellipsis,\n                    ),\n                    const Spacer(),\n                    Row(\n                      children: [\n                        Icon(\n                          Icons.calendar_today,\n                          size: 12,\n                          color: Theme.of(context).colorScheme.onSurface.withOpacity(0.5),\n                        ),\n                        const SizedBox(width: 4),\n                        Text(\n                          '${plant.dateAdded.day}/${plant.dateAdded.month}/${plant.dateAdded.year}',\n                          style: Theme.of(context).textTheme.bodySmall?.copyWith(\n                            color: Theme.of(context).colorScheme.onSurface.withOpacity(0.5),\n                          ),\n                        ),\n                        const Spacer(),\n                        GestureDetector(\n                          onTap: onDelete,\n                          child: Icon(\n                            Icons.delete_outline,\n                            size: 16,\n                            color: Theme.of(context).colorScheme.error,\n                          ),\n                        ),\n                      ],\n                    ),\n                  ],\n                ),\n              ),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\nclass _PlaceholderImage extends StatelessWidget {\n  const _PlaceholderImage();\n\n  @override\n  Widget build(BuildContext context) {\n    return Container(\n      color: Theme.of(context).colorScheme.surfaceVariant,\n      child: Center(\n        child: Icon(\n          Icons.local_florist,\n          size: 48,\n          color: Theme.of(context).colorScheme.onSurfaceVariant,\n        ),\n      ),\n    );\n  }\n}\n\nclass _EmptyGardenView extends StatelessWidget {\n  const _EmptyGardenView();\n\n  @override\n  Widget build(BuildContext context) {\n    return Center(\n      child: Padding(\n        padding: const EdgeInsets.all(32),\n        child: Column(\n          mainAxisAlignment: MainAxisAlignment.center,\n          children: [\n            Icon(\n              Icons.local_florist_outlined,\n              size: 96,\n              color: Theme.of(context).colorScheme.onSurface.withOpacity(0.3),\n            ),\n            const SizedBox(height: 24),\n            Text(\n              'Your garden is empty',\n              style: Theme.of(context).textTheme.headlineSmall?.copyWith(\n                fontWeight: FontWeight.bold,\n              ),\n            ),\n            const SizedBox(height: 8),\n            Text(\n              'Start by identifying your first plant using the camera',\n              style: Theme.of(context).textTheme.bodyMedium?.copyWith(\n                color: Theme.of(context).colorScheme.onSurface.withOpacity(0.7),\n              ),\n              textAlign: TextAlign.center,\n            ),\n            const SizedBox(height: 24),\n            ElevatedButton.icon(\n              onPressed: () => Get.find<HomeController>().changeTabIndex(1),\n              icon: const Icon(Icons.camera_alt),\n              label: const Text('Identify Plant'),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n\nclass _PlantDetailsSheet extends StatelessWidget {\n  final UserPlant plant;\n\n  const _PlantDetailsSheet({required this.plant});\n\n  @override\n  Widget build(BuildContext context) {\n    return Column(\n      crossAxisAlignment: CrossAxisAlignment.start,\n      mainAxisSize: MainAxisSize.min,\n      children: [\n        // Handle\n        Center(\n          child: Container(\n            width: 40,\n            height: 4,\n            decoration: BoxDecoration(\n              color: Theme.of(context).colorScheme.onSurface.withOpacity(0.3),\n              borderRadius: BorderRadius.circular(2),\n            ),\n          ),\n        ),\n        const SizedBox(height: 16),\n        \n        // Plant Name\n        Text(\n          plant.customName ?? plant.plant.commonName,\n          style: Theme.of(context).textTheme.headlineSmall?.copyWith(\n            fontWeight: FontWeight.bold,\n          ),\n        ),\n        Text(\n          plant.plant.scientificName,\n          style: Theme.of(context).textTheme.titleMedium?.copyWith(\n            fontStyle: FontStyle.italic,\n            color: Theme.of(context).colorScheme.onSurface.withOpacity(0.7),\n          ),\n        ),\n        const SizedBox(height: 16),\n        \n        // Care Requirements\n        Text(\n          'Care Requirements',\n          style: Theme.of(context).textTheme.titleMedium?.copyWith(\n            fontWeight: FontWeight.bold,\n          ),\n        ),\n        const SizedBox(height: 8),\n        \n        _CareRequirementItem(\n          icon: Icons.water_drop,\n          label: 'Water',\n          value: plant.plant.care.waterFrequency,\n        ),\n        _CareRequirementItem(\n          icon: Icons.wb_sunny,\n          label: 'Light',\n          value: plant.plant.care.lightRequirement,\n        ),\n        _CareRequirementItem(\n          icon: Icons.grass,\n          label: 'Soil',\n          value: plant.plant.care.soilType,\n        ),\n        \n        const SizedBox(height: 16),\n        \n        // Notes\n        if (plant.notes.isNotEmpty) ..[\n          Text(\n            'Notes',\n            style: Theme.of(context).textTheme.titleMedium?.copyWith(\n              fontWeight: FontWeight.bold,\n            ),\n          ),\n          const SizedBox(height: 8),\n          ...plant.notes.map((note) => Padding(\n            padding: const EdgeInsets.only(bottom: 4),\n            child: Text('â€¢ $note'),\n          )),\n        ],\n      ],\n    );\n  }\n}\n\nclass _CareRequirementItem extends StatelessWidget {\n  final IconData icon;\n  final String label;\n  final String value;\n\n  const _CareRequirementItem({\n    required this.icon,\n    required this.label,\n    required this.value,\n  });\n\n  @override\n  Widget build(BuildContext context) {\n    return Padding(\n      padding: const EdgeInsets.symmetric(vertical: 4),\n      child: Row(\n        children: [\n          Icon(icon, size: 20),\n          const SizedBox(width: 12),\n          Text(\n            '$label: ',\n            style: const TextStyle(fontWeight: FontWeight.w500),\n          ),\n          Expanded(child: Text(value)),\n        ],\n      ),\n    );\n  }\n}"