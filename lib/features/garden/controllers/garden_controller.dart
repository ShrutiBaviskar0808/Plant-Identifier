import 'package:get/get.dart';\nimport 'package:uuid/uuid.dart';\nimport '../../../core/data/models/user_plant.dart';\nimport '../../../core/data/models/plant.dart';\nimport '../../../core/data/local/database_service.dart';\n\nclass GardenController extends GetxController {\n  final _userPlants = <UserPlant>[].obs;\n  final _isLoading = false.obs;\n  final _error = Rxn<String>();\n\n  List<UserPlant> get userPlants => _userPlants;\n  bool get isLoading => _isLoading.value;\n  String? get error => _error.value;\n  int get plantCount => _userPlants.length;\n\n  @override\n  void onInit() {\n    super.onInit();\n    loadUserPlants();\n  }\n\n  Future<void> loadUserPlants() async {\n    _setLoading(true);\n    _error.value = null;\n\n    try {\n      final plants = await DatabaseService.getUserPlants();\n      _userPlants.assignAll(plants);\n    } catch (e) {\n      _error.value = 'Failed to load plants: $e';\n    } finally {\n      _setLoading(false);\n    }\n  }\n\n  Future<void> addPlant(Plant plant, {String? customName, String? location}) async {\n    try {\n      final userPlant = UserPlant(\n        id: const Uuid().v4(),\n        plant: plant,\n        customName: customName,\n        notes: [],\n        dateAdded: DateTime.now(),\n        location: location,\n        photos: [],\n      );\n\n      await DatabaseService.insertUserPlant(userPlant);\n      _userPlants.add(userPlant);\n      \n      Get.snackbar(\n        'Success',\n        '${plant.commonName} added to your garden!',\n        snackPosition: SnackPosition.BOTTOM,\n      );\n    } catch (e) {\n      _error.value = 'Failed to add plant: $e';\n      Get.snackbar(\n        'Error',\n        'Failed to add plant: $e',\n        snackPosition: SnackPosition.BOTTOM,\n      );\n    }\n  }\n\n  Future<void> removePlant(String plantId) async {\n    try {\n      await DatabaseService.deleteUserPlant(plantId);\n      _userPlants.removeWhere((plant) => plant.id == plantId);\n      \n      Get.snackbar(\n        'Success',\n        'Plant removed from garden',\n        snackPosition: SnackPosition.BOTTOM,\n      );\n    } catch (e) {\n      _error.value = 'Failed to remove plant: $e';\n      Get.snackbar(\n        'Error',\n        'Failed to remove plant: $e',\n        snackPosition: SnackPosition.BOTTOM,\n      );\n    }\n  }\n\n  Future<void> updatePlant(UserPlant updatedPlant) async {\n    try {\n      await DatabaseService.insertUserPlant(updatedPlant);\n      final index = _userPlants.indexWhere((plant) => plant.id == updatedPlant.id);\n      if (index != -1) {\n        _userPlants[index] = updatedPlant;\n      }\n    } catch (e) {\n      _error.value = 'Failed to update plant: $e';\n    }\n  }\n\n  Future<void> addNote(String plantId, String note) async {\n    final plantIndex = _userPlants.indexWhere((plant) => plant.id == plantId);\n    if (plantIndex != -1) {\n      final plant = _userPlants[plantIndex];\n      final updatedNotes = List<String>.from(plant.notes)..add(note);\n      final updatedPlant = plant.copyWith(notes: updatedNotes);\n      await updatePlant(updatedPlant);\n    }\n  }\n\n  Future<void> addPhoto(String plantId, String photoPath) async {\n    final plantIndex = _userPlants.indexWhere((plant) => plant.id == plantId);\n    if (plantIndex != -1) {\n      final plant = _userPlants[plantIndex];\n      final updatedPhotos = List<String>.from(plant.photos)..add(photoPath);\n      final updatedPlant = plant.copyWith(photos: updatedPhotos);\n      await updatePlant(updatedPlant);\n    }\n  }\n\n  List<UserPlant> getPlantsByCategory(String category) {\n    return _userPlants.where((plant) => plant.plant.category == category).toList();\n  }\n\n  List<UserPlant> searchPlants(String query) {\n    final lowercaseQuery = query.toLowerCase();\n    return _userPlants.where((plant) {\n      return plant.plant.commonName.toLowerCase().contains(lowercaseQuery) ||\n             plant.plant.scientificName.toLowerCase().contains(lowercaseQuery) ||\n             (plant.customName?.toLowerCase().contains(lowercaseQuery) ?? false);\n    }).toList();\n  }\n\n  Set<String> getUniqueCategories() {\n    return _userPlants.map((plant) => plant.plant.category).toSet();\n  }\n\n  int getPlantsAddedThisMonth() {\n    final now = DateTime.now();\n    return _userPlants.where((plant) {\n      return plant.dateAdded.year == now.year && plant.dateAdded.month == now.month;\n    }).length;\n  }\n\n  void _setLoading(bool loading) {\n    _isLoading.value = loading;\n  }\n\n  void clearError() {\n    _error.value = null;\n  }\n}